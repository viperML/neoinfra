# vim: syntax=bash
use_sops() {
    local path=${1:-$PWD/secrets.yaml}
    eval "$(sops -d --output-type dotenv "$path" | direnv dotenv bash /dev/stdin)"
    watch_file "$path"
}

use flake

export NOMAD_VAR_nixpkgs_rev="$(nix flake metadata . --json | jq -r '.locks.nodes.nixpkgs.locked.rev')"
export NOMAD_VAR_nixpkgs_narHash="$(nix flake metadata . --json | jq -r '.locks.nodes.nixpkgs.locked.narHash')"
export NOMAD_ADDR=http://sumati:4646
export VAULT_ADDR=http://kalypso:8200

use sops secrets/env.yaml
